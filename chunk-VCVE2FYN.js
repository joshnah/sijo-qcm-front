import{a as m}from"./chunk-SXTHDFRF.js";import{a as p,h as g}from"./chunk-L4DC4MBR.js";import{E as a,Pa as c,Sb as u,U as l,Y as i,ca as o,p as n}from"./chunk-PU24A2QT.js";var s=class t{getUser(){return window.localStorage.user?JSON.parse(window.localStorage.user):null}saveUser(r){window.localStorage.user=JSON.stringify(r)}destroyUser(){window.localStorage.removeItem("user")}static \u0275fac=function(e){return new(e||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})};var h=class t{http=o(p);jwtService=o(s);router=o(g);alertService=o(m);isAuthenticated=u(()=>!!this.userSignal());userSignal=c(null);user=this.userSignal.asReadonly();constructor(){this.setUserFromLocalStorage()}login(r){return this.http.post("/auth/signin",r).pipe(l(e=>{this.setAuth({token:e.token,login:r.login,role:e.role})}),a(e=>(console.error("Error occurred:",e),this.alertService.setMessage({message:"Login failed",type:"danger"}),n(()=>new Error("Login failed. Please try again.")))))}register(r){return this.http.post("/auth/signup",r)}purgeAuth(){this.jwtService.destroyUser(),this.userSignal.set(null)}setAuth(r){this.jwtService.saveUser(r),this.userSignal.set(r)}logout(){this.purgeAuth(),this.router.navigate(["/"])}hasTutorAccess(){return this.user()?.role==="ADMIN"||this.user()?.role==="TUTOR"}setUserFromLocalStorage(){let r=this.jwtService.getUser();r&&this.setAuth(r)}static \u0275fac=function(e){return new(e||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})};export{s as a,h as b};
