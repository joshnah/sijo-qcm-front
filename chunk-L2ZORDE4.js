import{a as h}from"./chunk-CVNQIEP5.js";import{a as f}from"./chunk-2QQHY5FA.js";import{b as m,i as g}from"./chunk-HB4LE65O.js";import{E as a,L as l,Pa as u,Sb as p,U as c,Y as i,ca as o,p as n}from"./chunk-I64YHXKP.js";var s=class t{getUser(){return window.localStorage.user?JSON.parse(window.localStorage.user):null}saveUser(r){window.localStorage.user=JSON.stringify(r)}destroyUser(){window.localStorage.removeItem("user")}static \u0275fac=function(e){return new(e||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})};var v=class t{http=o(m);jwtService=o(s);router=o(g);alertService=o(h);isAuthenticated=p(()=>!!this.userSignal());spinner=o(f);userSignal=u(null);user=this.userSignal.asReadonly();constructor(){this.setUserFromLocalStorage()}login(r){return this.spinner.openGlobalSpinner(),this.http.post("/auth/signin",r).pipe(l(()=>{this.spinner.closeGlobalSpinner()}),c(e=>{this.setAuth({token:e.token,login:r.login,role:e.role})}),a(e=>(console.error("Error occurred:",e),this.alertService.setMessage({message:"Login failed",type:"danger"}),n(()=>new Error("Login failed. Please try again.")))))}register(r){return this.http.post("/auth/signup",r)}purgeAuth(){this.jwtService.destroyUser(),this.userSignal.set(null)}setAuth(r){this.jwtService.saveUser(r),this.userSignal.set(r)}logout(){this.purgeAuth(),this.router.navigate(["/"])}hasTutorAccess(){return this.user()?.role==="ADMIN"||this.user()?.role==="TUTOR"}setUserFromLocalStorage(){let r=this.jwtService.getUser();r&&this.setAuth(r)}static \u0275fac=function(e){return new(e||t)};static \u0275prov=i({token:t,factory:t.\u0275fac,providedIn:"root"})};export{s as a,v as b};
