import{a as f,h as m}from"./chunk-ICYQ7GPO.js";import{$ as i,D as c,Db as p,Ma as s,R as u,V as o,o as l}from"./chunk-A7BKTUOQ.js";var a=class e{getUser(){return window.localStorage.user?JSON.parse(window.localStorage.user):null}saveUser(r){window.localStorage.user=JSON.stringify(r)}destroyUser(){window.localStorage.removeItem("user")}static \u0275fac=function(t){return new(t||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var n=class e{alertMessage=s(null);constructor(){}static \u0275fac=function(t){return new(t||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};var g=class e{http=i(f);jwtService=i(a);router=i(m);alertService=i(n);userSignal=s(null);isAuthenticated=p(()=>!!this.userSignal());user=this.userSignal.asReadonly();setUserFromLocalStorage(){let r=this.jwtService.getUser();r&&this.setAuth(r)}login(r){return this.http.post("/auth/",r).pipe(u(t=>{this.setAuth({token:t.token,login:r.login,role:t.role})}),c(t=>(console.error("Error occurred:",t),this.alertService.alertMessage.set({message:"Login failed",type:"danger"}),l(()=>new Error("Login failed. Please try again.")))))}register(r){return this.http.post("/auth/signup",r)}purgeAuth(){this.jwtService.destroyUser(),this.userSignal.set(null)}setAuth(r){this.jwtService.saveUser(r),this.userSignal.set(r)}logout(){this.purgeAuth(),this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||e)};static \u0275prov=o({token:e,factory:e.\u0275fac,providedIn:"root"})};export{n as a,g as b};
